<section>
  <form class="form-requests" [formGroup]="requestsForm" (ngSubmit)="onSubmit()">
    <mat-form-field>
      <mat-label>Required replacement part</mat-label>
      <mat-select formControlName="requiredPart">
        @for (productStock of productsStock(); track productStock.id){
          <mat-option [value]="productStock.id">{{productStock?.name}}</mat-option>
        }
        <mat-option [value]="0">Other</mat-option>
      </mat-select>
    </mat-form-field>
    @if (requiredPartSelected() == -1 ){
      <mat-form-field>
        <mat-label>Other part</mat-label>
        <input matInput formControlName="otherPart" required>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Observation</mat-label>
        <textarea matInput formControlName="observation"></textarea>
      </mat-form-field>
    }
    @if(requiredPartSelected() && requiredPartSelected() != -1){
      <label class="amount-available">
        <span>Total available: {{productStockSelected()?.amount}}</span>
      </label>
    }
    <mat-form-field>
      <mat-label>Quantity</mat-label>
      <input matInput type="number" formControlName="quantity" required>
    </mat-form-field>
    <div class="buttons">
      <button mat-button class="button" type="submit">{{isEditMode()?"Save": "Add"}}</button>
      @if(isEditMode()){
        <button mat-button class="button" type="button" (click)="onCancelRequest()">Cancel</button>
      }
    </div>
  </form>
  <header>
    @for (option of options(); track option){
      <button mat-button (click)="onOptionSelected(option)">{{option}}</button>
    }
  </header>
  <div>
    @if (selectedOption() === options()[1]){
      <table mat-table [dataSource]="productsRequested()" matSort>
        <ng-container matColumnDef="part">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Part</th>
          <td mat-cell *matCellDef="let data">{{data.name}}</td>
        </ng-container>
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantity</th>
          <td mat-cell *matCellDef="let data">{{data.requestedQuantity}}</td>
        </ng-container>
        <ng-container matColumnDef="observation">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Observation</th>
          <td mat-cell *matCellDef="let data">{{data.observation}}</td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let data">{{data.status}}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
          <td mat-cell *matCellDef="let data">
            @if (!isEditMode()){
              <button mat-icon-button color="warn" aria-label="Delete" (click)="onDeleteProductRequest(data.id)">
                <mat-icon>delete</mat-icon>
              </button>
              <button mat-icon-button color="primary" aria-label="Edit" (click)="onEditProductRequest(data)">
                <mat-icon>edit</mat-icon>
              </button>
            }
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumnsProductRequest"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsProductRequest;"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5,10,15]"></mat-paginator>
    }
    @if (selectedOption() === options()[0]){
      <table mat-table [dataSource]="taskProductsUsageCompletedInformation()" matSort>
        <ng-container matColumnDef="part">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Part</th>
          <td mat-cell *matCellDef="let data">{{data.productStock?.name}}</td>
        </ng-container>
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantity</th>
          <td mat-cell *matCellDef="let data">{{data.quantityUsed}}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
          <td mat-cell *matCellDef="let data">
            @if (!isEditMode()){
              <button mat-icon-button color="warn" aria-label="Delete" (click)="onDeleteTaskProductUsage(data.id)">
                <mat-icon>delete</mat-icon>
              </button>
              <button mat-icon-button color="primary" aria-label="Edit" (click)="onEditTaskProductUsage(data)">
                <mat-icon>edit</mat-icon>
              </button>
            }
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumnsTaskProductUsage"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsTaskProductUsage;"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5,10,15]"></mat-paginator>
    }
  </div>
</section>
